---
title: Разрешение доступа по ssh только для определённых ip-адресов
id: whitelist-access-ssh-by-ip-subnet
---

Для внедрения дополнительного слоя безопасности для ваших нод, можно добавить запрет на подключение к ним по ssh с не известных адресов, например с адресов не входящих в диапазон сети вашего корпоративного VPN.

Разрешаем только для нужных ip-адресов
```sh
iptables -A INPUT -p tcp --dport 22 -s <подсеть или конкретный ip-адрес> -j ACCEPT
```

Запрещаем для всех остальных
```sh
iptables -A INPUT -p tcp --dport 22 -j DROP
```

После введённых выше команд тестируем подключение и если всё ок, то сохраняем настройки iptables, чтобы они остались такими и после перезапуска системы. 

___

Сделать это можно несколькими способами, но я рекомендую использовать пакет `iptables-persistent`.

```sh
apt-get install iptables-persistent
```

После установки в директории `/etc/iptables` у вас появятся два файла: для ipv4 и ipv6.
Также в системе появляется новая служба - netfilter-persistent, которая позволяет удобно управлять брандмауэром, так если вы внесли изменения в файл с правилами и хотите их применить, то выполните:
```sh
netfilter-persistent reload
```

Для сохранения текущей конфигурации отдайте команду:
```sh
netfilter-persistent save
```